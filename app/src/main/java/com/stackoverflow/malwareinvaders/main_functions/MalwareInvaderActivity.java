package com.stackoverflow.malwareinvaders.main_functions;

import android.app.Dialog;
import android.content.Intent;
import android.support.v7.app.AppCompatActivity;
import android.os.Bundle;
import android.graphics.Point;
import android.view.Display;
import android.view.View;
import android.widget.Button;
import android.widget.FrameLayout;
import android.widget.RelativeLayout;

import java.util.HashMap;
import java.util.Map;

public class MalwareInvaderActivity extends AppCompatActivity {
    /**
     Create the main game object to start the game
     */
    private MalwareInvader mMalwareInvaderGame;
    public Map<String, Integer> record = new HashMap<String, Integer>();
    FrameLayout game;
    Dialog mdialog;
    private boolean musicOn = true;

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        SoundManager.InitSound();
        super.onCreate(savedInstanceState);
        mdialog = new Dialog(this);
        // block out an area on the screen to display a game
        game = new FrameLayout(this);
        // Initialization by getting the screen resolution
        Display display = getWindowManager().getDefaultDisplay();
        Point size = new Point();
        display.getSize(size);
        // this : refer to MalwareInvaderActivity and MalwareInvader class will need to perform actions (use methods)
        mMalwareInvaderGame = new MalwareInvader(this,size.x,size.y);
        game.addView(mMalwareInvaderGame,0); // adds superBreakoutGame surfaceView to the frame
        // Set game as child view
        final RelativeLayout mainLayout = (RelativeLayout) View.inflate(this, R.layout.activity_game, null);
        mainLayout.addView(game,0);
        setContentView(mainLayout);

        // Set background music
        startService(new Intent(this,MyService.class));
    }

    /*The point to note here is that by adding these overridden methods we are giving the OS the opportunity to notify us of the player's intentions in two more situations.*/
    @Override
    protected void onResume() {
        super.onResume();
        // More code here later in the chapter
        mMalwareInvaderGame.resume();
    }

    @Override
    protected void onPause() {
        super.onPause();
        // More code here later in the chapter
        mMalwareInvaderGame.pause();
        mMalwareInvaderGame.sustainGame();
        showPauseMenu();

    }

    @Override
    protected void onStart() {
        super.onStart();
        // More code here later in the chapter
        mMalwareInvaderGame.start();
    }

    protected void endGame(int mScore) {
        Intent intent = new Intent(getApplicationContext(), GameoverPop.class);
        intent.putExtra("score", mScore);
        startActivity(intent);

    }

    public void pauseGame(View view) {
        if ( mMalwareInvaderGame.sustainGame() ){
            showPauseMenu();
        }
    }

    private void showPauseMenu() {
        mdialog.setContentView(R.layout.pause_menu);
        mdialog.setCancelable(false);
        mdialog.show();
        Button resume = (Button) mdialog.findViewById(R.id.resume);
        Button mainMenu = (Button) mdialog.findViewById(R.id.mainMenu);
        resume.setOnClickListener(new View.OnClickListener(){
            @Override
            public void onClick(View view) {
                mMalwareInvaderGame.sustainGame();
                mdialog.dismiss();
            }
        });
        mainMenu.setOnClickListener(new View.OnClickListener(){
            @Override
            public void onClick(View view) {
                Intent intent = new Intent(getApplicationContext(), MainActivity.class);
                startActivity(intent);
            }
        });
    }

    public void controlMusic(View view) {
        if (musicOn){
            musicOn = false;
            stopService(new Intent(this,MyService.class));
        }else{
            musicOn = true;
            startService(new Intent(this,MyService.class));
        }
    }

}
